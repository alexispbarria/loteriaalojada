<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoterÃ­a Mexicana</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Topbar -->
    <header class="topbar">
        <button id="back-to-home-btn" class="back-btn">â†</button>
        <h1>LoterÃ­a Mexicana</h1>
        <div id="auth-container">
            <button id="auth-btn">Iniciar sesiÃ³n / Registrarse</button>
            <div id="user-menu" class="hidden user-menu">
                <button id="user-name-btn" class="user-name-btn">Usuario</button>
                <div id="user-dropdown" class="user-dropdown hidden">
                    <button id="change-password-btn">Cambiar contraseÃ±a</button>
                    <button id="logout-btn">Cerrar sesiÃ³n</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal: login -->
    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Iniciar sesiÃ³n / Registrarse</h2>
            <form id="auth-form">
                <input type="text" id="nickname" placeholder="Nickname" required>
                <input type="password" id="password" placeholder="ContraseÃ±a" required>
                <button type="submit">Continuar</button>
                <p id="auth-message"></p>
            </form>
        </div>
    </div>

    <!-- Modal: cambiar contraseÃ±a -->
    <div id="password-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Cambiar contraseÃ±a</h2>
            <form id="password-form">
                <input type="password" id="current-password" placeholder="ContraseÃ±a actual" required>
                <input type="password" id="new-password" placeholder="Nueva contraseÃ±a" required>
                <input type="password" id="confirm-password" placeholder="Confirmar nueva contraseÃ±a" required>
                <button type="submit">Actualizar contraseÃ±a</button>
                <p id="password-message"></p>
            </form>
        </div>
    </div>

    <!-- Modal: advertencia (no logueado) -->
    <div id="login-required-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Â¡AtenciÃ³n!</h2>
            <p>Debes iniciar sesiÃ³n o registrarte para seleccionar cartas.</p>
            <button id="go-to-login-btn">Iniciar sesiÃ³n</button>
        </div>
    </div>

    <!-- Modal: cartas ya seleccionadas -->
    <div id="cards-locked-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Cartas bloqueadas</h2>
            <p>Tus cartas ya han sido seleccionadas y no pueden ser modificadas.</p>
            <button id="close-locked-modal">Cerrar</button>
        </div>
    </div>

    <!-- Modal: cartas de usuario -->
    <div id="user-cards-modal" class="modal hidden">
        <div class="modal-content" style="text-align:center;">
            <span class="close">&times;</span>
            <p id="user-cards-message"></p>
            <button id="copy-cards-btn">ğŸ“‹ Copiar</button>
        </div>
    </div>

    <!-- Modal: tabla cerrada -->
    <div id="table-closed-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ğŸ“‹ InscripciÃ³n cerrada</h2>
            <p>La inscripciÃ³n para la LoterÃ­a estÃ¡ actualmente cerrada. Por favor, espera a que se abra nuevamente.</p>
            <button id="close-table-modal">Cerrar</button>
        </div>
    </div>

    <!-- Modal: generador de cartas (solo admin) -->
    <div id="card-generator-modal" class="modal hidden">
        <div class="modal-content generator-modal">
            <span class="close">&times;</span>
            <h2>Generador de Cartas - LoterÃ­a Mexicana</h2>
            <div class="generator-main">
                <!-- Ãrea de miniaturas -->
                <div class="miniatures-container">
                    <div id="miniatures-grid" class="miniatures-grid"></div>
                </div>

                <!-- Panel derecho: carta actual + botones -->
                <div class="current-card-panel">
                    <div class="current-card-display">
                        <!-- Contadores -->
                        <div class="card-counters">
                            <span id="cards-generated-count">0</span> / <span id="cards-remaining-count">54</span>
                        </div>
                        <div id="generator-placeholder" class="generator-placeholder">
                            Pulse "Siguiente carta" para comenzar
                        </div>
                        <div id="fin-juego" class="fin-juego" style="display:none;">
                            ğŸ‰ Fin del Juego
                        </div>
                        <img id="current-card-img" src="" alt="Carta actual" style="display:none;">
                        <p id="current-card-name" class="current-card-name" style="display:none;">â€”</p>
                    </div>
                    <button id="next-card-btn" class="next-card-btn">Siguiente carta ğŸ²</button>
                    <button id="copy-current-card" class="copy-btn">ğŸ“‹ Copiar nombre</button>
                    <button id="reset-generator-btn" class="reset-btn">ğŸ”„ Reiniciar Bingo</button>
                    <button id="capture-screenshot-btn" class="capture-btn">ğŸ“¤ Captura de Cartas</button>
                    <div id="screenshot-link-container" class="screenshot-link-container hidden">
                        <input type="text" id="screenshot-link" class="screenshot-link-input" readonly>
                        <button id="copy-screenshot-link" class="copy-link-btn">ğŸ“‹ Copiar</button>
                    </div>
                    <!-- âœ… NUEVO: Input y botÃ³n para xat -->
                    <div style="margin-top: 15px;">
                        <label style="font-weight:bold; font-size:0.9rem; display:block; margin-bottom:5px;">
                            Nombre del grupo xat:
                        </label>
                        <input type="text" id="xat-group-name" value="Viciososymas" placeholder="Ej: Viciososymas"
                            style="width:100%; padding:8px; border:1px solid #ccc; border-radius:4px; margin-bottom:8px;">
                        <button id="redirect-to-xat-btn"
                            style="width:100%; padding:10px; background:#673AB7; color:white; border:none; border-radius:6px; font-weight:bold;">
                            â¡ï¸ Redirigir al xat
                        </button>
                    </div>
                </div>

            </div>
            <!-- Ãšltima carta generada -->
            <div class="last-card-section">
                <h3>Ãšltima carta generada:</h3>
                <div id="last-card-display" class="last-card-display">
                    <span id="last-card-text">Ninguna</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Mini modal de confirmaciÃ³n de reinicio -->
    <div id="reset-confirm-modal" class="modal hidden">
        <div class="modal-content" style="text-align:center; max-width: 350px;">
            <span class="close reset-close">&times;</span>
            <h3>Â¿Reiniciar Bingo?</h3>
            <p>EstÃ¡s seguro que deseas reiniciar el bingo?</p>
            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                <button id="cancel-reset" class="reset-btn cancel">Cancelar</button>
                <button id="confirm-reset" class="reset-btn confirm">Reiniciar</button>
            </div>
        </div>
    </div>

    <!-- Modal: advertencia al intentar reducir cartas por usuario -->
    <div id="cards-reduction-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>âš ï¸ AcciÃ³n no permitida</h2>
            <p>Ya existen usuarios con 2 cartas seleccionadas. No puedes reducir el lÃ­mite a 1 carta por usuario.</p>
            <button id="close-reduction-modal"
                style="width:100%; padding:10px; background:#ff9800; color:white; border:none; border-radius:6px; font-weight:bold; margin-top:15px;">
                Entendido
            </button>
        </div>
    </div>

    <!-- Tabla principal -->
    <div class="bingo-container">
        <div class="desktop-table"></div>
        <div class="mobile-table"></div>
        <div class="table-counters">
            <span id="cards-selected-count">0</span> / <span id="cards-available-count">54</span>
        </div>
    </div>

    <!-- Panel de admin -->
    <div id="admin-panel" class="hidden admin-panel">
        <!-- Los botones se crearÃ¡n dinÃ¡micamente -->
    </div>

    <!-- BotÃ³n de confirmaciÃ³n de selecciÃ³n -->
    <div id="confirm-selection" class="hidden confirm-selection">
        <p>Tus cartas seleccionadas: <span id="selected-cards-display"></span></p>
        <button id="confirm-btn">âœ… Seleccionar cartas</button>
        <button id="copy-cards-btn-bottom" style="
        background: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
    ">ğŸ“‹ Copiar Cartas</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="config.js"></script>
    <script src="loteria.js"></script>
    <script src="auth.js"></script>
</body>

</html>